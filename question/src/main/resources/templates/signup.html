<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}" layout:fragment="content">


<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>회원가입</title>
    <style>
        @media (min-width: 769px) {

            /* 노트북 이상의 사이즈에서 적용 */
            .form-signup {
                max-width: 500px;
                /* 입력 필드의 최대 너비를 500px로 제한 */
                margin: 0 auto;
                /* 중앙 정렬 */
            }
        }
    </style>

</head>

<body>
    <div class="container text-center">
        <div class="logo mb-4">
            <!-- 로고 -->
            <a href="/"><img src="/logo.png" alt="logo" width="100" style="border-radius: 50%;" /></a>
        </div>
        <h1 class="mb-3 fw-normal">회원가입</h1>
        <form class="form-signup" action="#" th:action="@{/member/signup}" th:object="${signupDto}" method="post">
            <!-- 이름 필드 -->
            <div class="input-group form-floating mb-3">
                <input type="text" class="form-control my-class" id="name" placeholder=" " name="name" required
                    aria-describedby="button-addon1" th:field="*{name}" />
                <label for="name">이름</label>
                <button class="btn btn-outline-secondary" id="button-addon1" type="button" onclick="checkName()">
                    중복 확인 </button>
            </div>
            <!-- 이메일 필드 -->
            <div class="input-group form-floating mb-3">
                <input type="email" class="form-control" id="email" placeholder=" " name="email" required
                    aria-describedby="button-addon2" th:field="*{email}" />
                <label for="email">이메일</label>
                <button class="btn btn-outline-secondary" id="button-addon2" type="button" onclick="checkEmail()">
                    중복 확인 </button>
            </div>
            <!-- 비밀번호 필드 -->
            <div class="form-floating mb-4">
                <input type="password" class="form-control" id="floatingPassword" placeholder=" " name="password"
                    required />
                <label for="floatingPassword">비밀번호</label>
            </div>
            <input type="hidden" id="csrfToken" th:value="${_csrf.token}" />
            <input type="hidden" id="csrfHeader" th:value="${_csrf.headerName}" />
            <!-- 에러 메시지 -->
            <p th:if="${errorMessage}" class="text-danger">
                <span th:text="${errorMessage}"></span>
            </p>
            <button class="w-100 btn btn-lg btn-primary" type="submit">회원가입</button>
        </form>
    </div>


    <script>
        function getCsrfToken() {
            return {
                token: document.getElementById('csrfToken').value,
                header: document.getElementById('csrfHeader').value
            };
        }
        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }
        function checkEmail() {
            var email = document.getElementById('email').value;
            var csrf = getCsrfToken();

            if (email === '') {
                alert('이메일을 입력해주세요.');
                return;
            }
            if (!validateEmail(email)) {
                alert('올바른 이메일 형식을 입력해주세요.');
                return;
            }
            fetch('/member/check-email', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [csrf.header]: csrf.token
                },
                body: JSON.stringify({ email: email })
            })
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        alert('이미 사용 중인 이메일입니다.');
                    } else {
                        alert('사용 가능한 이메일입니다.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function checkName() {
            var name = document.getElementById('name').value;
            var csrf = getCsrfToken();

            if (name === '') {
                alert('이름을 입력해주세요.');
                return;
            }
            fetch('/member/check-name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    [csrf.header]: csrf.token
                },
                body: JSON.stringify({ name: name })
            })
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        alert('이미 사용 중인 이름입니다.');
                    } else {
                        alert('사용 가능한 이름입니다.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    </script>

</body>

</html>